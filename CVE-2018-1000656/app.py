from flask import Flask, request, jsonify

app = Flask(__name__)

# Vulnerable authentication check that only applies to GET requests
@app.before_request
def check_authentication():
    if request.method == 'GET':  # Only check for GET requests
        auth_token = request.headers.get('Authorization')
        if not auth_token or auth_token != 'secret-token':
            return jsonify({"error": "Unauthorized"}), 401

# Protected route (allows GET, POST, OPTIONS, and HEAD)
@app.route('/protected', methods=['GET', 'POST', 'OPTIONS', 'HEAD'])
def protected():
    if request.method == 'POST':
        return jsonify({"message": "You sent a POST request!"})
    elif request.method == 'HEAD':
        return '', 200
    return jsonify({"message": "Welcome to the protected route!"})

# Public route
@app.route('/', methods=['GET'])
def index():
    return jsonify({"message": "This is a public route."})

if __name__ == "__main__":
    app.run(debug=True, host='0.0.0.0')
